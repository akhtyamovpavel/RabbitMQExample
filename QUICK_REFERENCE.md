# üöÄ –ë—ã—Å—Ç—Ä–∞—è –°–ø—Ä–∞–≤–∫–∞ - RabbitMQ + Celery Project

## üìã –í—Å–µ –°–µ—Ä–≤–∏—Å—ã –∏ –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|-------|----------|
| **–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** | http://localhost:8080 | - | –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞—á |
| **Flower** üå∏ | http://localhost:5555 | - | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery –∑–∞–¥–∞—á |
| **RabbitMQ Management** | http://localhost:15672 | student/qwerty | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏ |

---

## üéØ –ë—ã—Å—Ç—Ä—ã–µ –ö–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –∏ –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞
./run_celery.sh

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose stop

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
docker compose down -v
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å Celery Worker'—ã
docker compose up -d --scale celery_worker=3

# –£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ç–∞—Ä—ã–µ Consumer'—ã
docker compose up -d --scale consumer=2
```

### –õ–æ–≥–∏

```bash
# –í—Å–µ –ª–æ–≥–∏
docker compose logs -f

# –¢–æ–ª—å–∫–æ Celery
docker compose logs -f celery_worker

# –¢–æ–ª—å–∫–æ Flower
docker compose logs -f flower

# –¢–æ–ª—å–∫–æ API
docker compose logs -f api
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery

```bash
# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
docker compose exec celery_worker celery -A celery_app inspect active

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
docker compose exec celery_worker celery -A celery_app inspect stats

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
docker compose exec celery_worker celery -A celery_app inspect registered
```

---

## üîÑ –ú–µ—Ç–æ–¥—ã –û—Ç–ø—Ä–∞–≤–∫–∏ –ó–∞–¥–∞—á

| –ú–µ—Ç–æ–¥ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-------|------------|-------------------|-----------|
| **Celery** ‚ú® | Celery + RabbitMQ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á | –ù–∏–∑–∫–∞—è |
| **RabbitMQ** üì® | Pika + RabbitMQ | –ù—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ—á–µ—Ä–µ–¥—è–º–∏ | –°—Ä–µ–¥–Ω—è—è |
| **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ** üìã | HTTP | –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (< 100ms) | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |
| **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –¥–æ–ª–≥–æ–µ** ‚è±Ô∏è | HTTP | –¢–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
RabbitMQExample/
‚îú‚îÄ‚îÄ api/                        # API —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ celery_app.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery
‚îÇ   ‚îú‚îÄ‚îÄ celery_tasks.py        # –ó–∞–¥–∞—á–∏ Celery
‚îÇ   ‚îú‚îÄ‚îÄ gui/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ home_view.py       # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ API
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îî‚îÄ‚îÄ home.html          # HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ consumer/                   # –°—Ç–∞—Ä—ã–π consumer (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ rmq/                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RabbitMQ
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ definitions.json
‚îú‚îÄ‚îÄ docker-compose.yml          # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ requirements.txt            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ run_celery.sh              # –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ README.md                   # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ CELERY_GUIDE.md            # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Celery
‚îú‚îÄ‚îÄ FLOWER_GUIDE.md            # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Flower
‚îî‚îÄ‚îÄ QUICK_REFERENCE.md         # –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
```

---

## üß™ –ë—ã—Å—Ç—Ä—ã–µ –¢–µ—Å—Ç—ã

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –†–∞–±–æ—Ç–∞ Celery (30 —Å–µ–∫—É–Ω–¥)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
docker compose up -d

# 2. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080

# 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ Celery (timeout=5)

# 4. –û—Ç–∫—Ä–æ–π—Ç–µ Flower http://localhost:5555

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–¥–∞—á—É –≤ Tasks ‚Üí Success
```

### –¢–µ—Å—Ç 2: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

```bash
# 1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ worker'—ã
docker compose up -d --scale celery_worker=3

# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ 10 –∑–∞–¥–∞—á (timeout=10)

# 3. –í Flower ‚Üí Workers —É–≤–∏–¥–∏—Ç–µ 3 worker'–∞

# 4. –í Flower ‚Üí Monitor –Ω–∞–±–ª—é–¥–∞–π—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
```

### –¢–µ—Å—Ç 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ú–µ—Ç–æ–¥–æ–≤ (1 –º–∏–Ω—É—Ç–∞)

```bash
# 1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ "–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –¥–æ–ª–≥–æ–µ" (7 —Å–µ–∫)
#    ‚Üí –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≤–∏—Å–Ω–µ—Ç

# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ "Celery" (5 —Å–µ–∫)
#    ‚Üí –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

# 3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞–¥–∞—á
```

---

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ URL

| –ß—Ç–æ –Ω—É–∂–Ω–æ | URL |
|-----------|-----|
| –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É | http://localhost:8080 |
| –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–¥–∞—á–∏ Celery | http://localhost:5555/tasks |
| –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å worker'–æ–≤ | http://localhost:5555/workers |
| –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ | http://localhost:5555 (Dashboard) |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ | http://localhost:5555/monitor |
| –û—á–µ—Ä–µ–¥–∏ RabbitMQ | http://localhost:15672/#/queues |

---

## üéì –£—á–µ–±–Ω—ã–µ –°—Ü–µ–Ω–∞—Ä–∏–∏

### –î–ª—è –°—Ç—É–¥–µ–Ω—Ç–æ–≤: "Celery vs –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π"

1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ "–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –¥–æ–ª–≥–æ–µ" (ID=10)
   - –ó–∞—Å–µ–∫–∏—Ç–µ –≤—Ä–µ–º—è ‚Üí ~7 —Å–µ–∫—É–Ω–¥
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π ‚Üí –±—É–¥–µ—Ç –∂–¥–∞—Ç—å

2. **Celery –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ "Celery" (timeout=7)
   - –ó–∞—Å–µ–∫–∏—Ç–µ –≤—Ä–µ–º—è ‚Üí < 1 —Å–µ–∫—É–Ω–¥–∞
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—â—ë 5 –∑–∞–¥–∞—á ‚Üí –≤—Å–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ

3. **–í—ã–≤–æ–¥:**
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ = –ª—É—á—à–µ UX
   - API –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ

### –î–ª—è –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

```bash
# 1. –ü–æ–∫–∞–∂–∏—Ç–µ –ø—É—Å—Ç–æ–π Flower Dashboard
open http://localhost:5555

# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ 20 –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# (timeout=10 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥–∞—è)

# 3. –ü–æ–∫–∞–∂–∏—Ç–µ Flower ‚Üí Monitor
# (–∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

# 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ
docker compose up -d --scale celery_worker=5

# 5. –ü–æ–∫–∞–∂–∏—Ç–µ, –∫–∞–∫ –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏–ª–∏—Å—å
# Flower ‚Üí Workers (5 worker'–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã)

# 6. –û–±—ä—è—Å–Ω–∏—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Dashboard
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery

### –ö–ª—é—á–µ–≤—ã–µ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `broker` | `amqp://student:qwerty@rmq:5672/` | RabbitMQ URL |
| `backend` | `rpc://` | Backend –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| `task_serializer` | `json` | –§–æ—Ä–º–∞—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ |
| `task_track_started` | `True` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∞ –∑–∞–¥–∞—á |
| `worker_prefetch_multiplier` | `3` | –ó–∞–¥–∞—á –Ω–∞ worker |
| `concurrency` | `3` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è

```bash
RMQ_URL=amqp://student:qwerty@rmq:5672/
API_URL=http://api:8080/update_task_status_api/
```

---

## üêõ –ë—ã—Å—Ç—Ä–æ–µ –†–µ—à–µ–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| Flower –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è | `docker compose logs flower` ‚Üí –ü–æ–¥–æ–∂–¥–∏—Ç–µ 15 —Å–µ–∫ |
| –ó–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è | `docker compose logs celery_worker` ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ worker'—ã |
| RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | `docker compose restart rmq` ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ |
| API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç | `docker compose restart api` |
| –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç | –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `docker-compose.yml` |

### –ü–æ–ª–Ω—ã–π –†–µ—Å—Ç–∞—Ä—Ç

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
docker compose down
docker compose build --no-cache
docker compose up -d
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[README.md](README.md)** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **[CELERY_GUIDE.md](CELERY_GUIDE.md)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Celery
- **[FLOWER_GUIDE.md](FLOWER_GUIDE.md)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Flower

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Flower –¥–ª—è –≤—Å–µ–≥–æ**
   - –õ—É—á—à–µ, —á–µ–º –ª–æ–≥–∏
   - –ù–∞–≥–ª—è–¥–Ω–æ –∏ —É–¥–æ–±–Ω–æ

2. **–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ**
   - 1 worker –¥–ª—è –Ω–∞—á–∞–ª–∞
   - –ü–æ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ

3. **–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏**
   - Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ error rate

4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - 1 ‚Üí 3 ‚Üí 5 worker'–æ–≤
   - –°—Ä–∞–≤–Ω–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

5. **–ß–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
   - Celery –æ—á–µ–Ω—å –≥–∏–±–∫–∏–π
   - –ú–Ω–æ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å:
- ‚úÖ Celery –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ Flower –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ RabbitMQ –∫–∞–∫ –±—Ä–æ–∫–µ—Ä
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ù–∞—á–Ω–∏—Ç–µ —Å:** http://localhost:8080

**–£–¥–∞—á–∏! üöÄ**

